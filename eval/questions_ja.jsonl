{"id":1,"category":"time_agg","question":"先月のpaidの売上合計を教えて","reference_sql":"SELECT COALESCE(SUM(total_jpy),0) AS total_sales FROM orders WHERE status='paid' AND order_date >= date_trunc('month', CURRENT_DATE - INTERVAL '1 month') AND order_date < date_trunc('month', CURRENT_DATE);"}
{"id":2,"category":"time_agg","question":"今月のpaidの売上合計を教えて","reference_sql":"SELECT COALESCE(SUM(total_jpy),0) AS total_sales FROM orders WHERE status='paid' AND order_date >= date_trunc('month', CURRENT_DATE) AND order_date < (date_trunc('month', CURRENT_DATE) + INTERVAL '1 month');"}
{"id":3,"category":"count","question":"直近30日間の注文数をステータス別に出して","reference_sql":"SELECT status, COUNT(*) AS order_count FROM orders WHERE order_date >= CURRENT_DATE - INTERVAL '30 days' GROUP BY status ORDER BY status;"}
{"id":4,"category":"join_filter","question":"田中 太郎の直近90日間のpaid売上合計を出して","reference_sql":"SELECT COALESCE(SUM(o.total_jpy),0) AS total_sales FROM orders o JOIN customers c ON c.customer_id=o.customer_id WHERE c.name='田中 太郎' AND o.status='paid' AND o.order_date >= CURRENT_DATE - INTERVAL '90 days';"}
{"id":5,"category":"topn","question":"売上（paidの合計）が多い顧客TOP2を出して","reference_sql":"SELECT c.customer_id, c.name, SUM(o.total_jpy) AS total_sales FROM orders o JOIN customers c ON c.customer_id=o.customer_id WHERE o.status='paid' GROUP BY c.customer_id, c.name ORDER BY total_sales DESC, c.customer_id ASC LIMIT 2;"}
{"id":6,"category":"join_group","question":"直近60日間のカテゴリ別売上（paid）を出して","reference_sql":"SELECT p.category, SUM(oi.unit_price_jpy*oi.quantity) AS sales FROM orders o JOIN order_items oi ON oi.order_id=o.order_id JOIN products p ON p.product_id=oi.product_id WHERE o.status='paid' AND o.order_date >= CURRENT_DATE - INTERVAL '60 days' GROUP BY p.category ORDER BY sales DESC, p.category ASC;"}
{"id":7,"category":"topn","question":"直近60日間で一番売れた商品（数量ベース）を出して","reference_sql":"SELECT p.product_id, p.name, SUM(oi.quantity) AS qty FROM orders o JOIN order_items oi ON oi.order_id=o.order_id JOIN products p ON p.product_id=oi.product_id WHERE o.status IN ('paid','shipped') AND o.order_date >= CURRENT_DATE - INTERVAL '60 days' GROUP BY p.product_id, p.name ORDER BY qty DESC, p.product_id ASC LIMIT 1;"}
{"id":8,"category":"filter","question":"非アクティブ（is_active=false）の商品一覧を出して","reference_sql":"SELECT product_id, name, category, price_jpy FROM products WHERE is_active=FALSE ORDER BY product_id;"}
{"id":9,"category":"count","question":"カテゴリ別のアクティブ商品数を出して","reference_sql":"SELECT category, COUNT(*) AS active_products FROM products WHERE is_active=TRUE GROUP BY category ORDER BY active_products DESC, category ASC;"}
{"id":10,"category":"anti_join","question":"注文が一度もない顧客を出して","reference_sql":"SELECT c.customer_id, c.name FROM customers c LEFT JOIN orders o ON o.customer_id=c.customer_id WHERE o.order_id IS NULL ORDER BY c.customer_id;"}
{"id":11,"category":"time_series","question":"直近14日間の日別売上（paid）を日付昇順で出して","reference_sql":"SELECT order_date, SUM(total_jpy) AS sales FROM orders WHERE status='paid' AND order_date >= CURRENT_DATE - INTERVAL '14 days' GROUP BY order_date ORDER BY order_date ASC;"}
{"id":12,"category":"avg","question":"直近90日間のpaidの平均注文単価（平均total_jpy）を出して","reference_sql":"SELECT COALESCE(AVG(total_jpy),0) AS avg_order_value FROM orders WHERE status='paid' AND order_date >= CURRENT_DATE - INTERVAL '90 days';"}
{"id":13,"category":"topn","question":"商品単価が高い順にアクティブ商品TOP3を出して","reference_sql":"SELECT product_id, name, price_jpy FROM products WHERE is_active=TRUE ORDER BY price_jpy DESC, product_id ASC LIMIT 3;"}
{"id":14,"category":"join_filter","question":"注文ステータスがcancelledの注文について、顧客名と注文日と金額を出して","reference_sql":"SELECT c.name, o.order_date, o.total_jpy FROM orders o JOIN customers c ON c.customer_id=o.customer_id WHERE o.status='cancelled' ORDER BY o.order_date DESC, o.order_id DESC;"}
{"id":15,"category":"join_group","question":"顧客別の注文回数を多い順に出して","reference_sql":"SELECT c.customer_id, c.name, COUNT(o.order_id) AS order_count FROM customers c LEFT JOIN orders o ON o.customer_id=c.customer_id GROUP BY c.customer_id, c.name ORDER BY order_count DESC, c.customer_id ASC;"}
{"id":16,"category":"repeat","question":"2回以上注文したことがある顧客を出して","reference_sql":"SELECT c.customer_id, c.name, COUNT(o.order_id) AS order_count FROM customers c JOIN orders o ON o.customer_id=c.customer_id GROUP BY c.customer_id, c.name HAVING COUNT(o.order_id) >= 2 ORDER BY order_count DESC, c.customer_id ASC;"}
{"id":17,"category":"join_group","question":"注文1件あたりの明細行数（order_itemsの行数）を注文IDごとに出して","reference_sql":"SELECT o.order_id, COUNT(oi.order_item_id) AS item_lines FROM orders o LEFT JOIN order_items oi ON oi.order_id=o.order_id GROUP BY o.order_id ORDER BY o.order_id ASC;"}
{"id":18,"category":"calc","question":"直近30日間のキャンセル率（cancelled件数/全注文件数）を小数で出して","reference_sql":"SELECT CASE WHEN COUNT(*)=0 THEN 0 ELSE (SUM(CASE WHEN status='cancelled' THEN 1 ELSE 0 END)::decimal / COUNT(*)) END AS cancel_rate FROM orders WHERE order_date >= CURRENT_DATE - INTERVAL '30 days';"}
{"id":19,"category":"join_group","question":"直近60日間の顧客別売上（paid）を出して","reference_sql":"SELECT c.customer_id, c.name, COALESCE(SUM(o.total_jpy),0) AS sales FROM customers c LEFT JOIN orders o ON o.customer_id=c.customer_id AND o.status='paid' AND o.order_date >= CURRENT_DATE - INTERVAL '60 days' GROUP BY c.customer_id, c.name ORDER BY sales DESC, c.customer_id ASC;"}
{"id":20,"category":"exists","question":"注文がある商品だけを重複なしで商品名昇順に出して","reference_sql":"SELECT DISTINCT p.name FROM products p JOIN order_items oi ON oi.product_id=p.product_id ORDER BY p.name ASC;"}